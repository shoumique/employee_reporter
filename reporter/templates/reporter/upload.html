{% extends "reporter/base.html" %}
{% block title %}ржЖржкрж▓рзЛржб тАУ ржХрж░рзНржорзА рж░рж┐ржкрзЛрж░рзНржЯ{% endblock %}

{% block extra_head %}
<style>
  .upload-zone {
    border: 2.5px dashed #b0c4de;
    border-radius: 16px;
    background: #fff;
    transition: border-color .2s, background .2s;
    cursor: pointer;
  }
  .upload-zone:hover, .upload-zone.dragover {
    border-color: var(--accent);
    background: #eef4ff;
  }
  .upload-zone input[type=file] {
    position: absolute;
    inset: 0;
    opacity: 0;
    cursor: pointer;
    width: 100%;
    height: 100%;
  }
  .upload-icon { font-size: 3.5rem; color: #b0c4de; }
</style>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-6 col-md-8">

    <!-- Title -->
    <div class="text-center mb-4">
      <h2 class="fw-bold bn" style="color:var(--primary)">ржХрж░рзНржорзА рж░рж┐ржкрзЛрж░рзНржЯ ржЬрзЗржирж╛рж░рзЗржЯрж░</h2>
      <p class="text-muted bn-sm">
        Excel ржбрзЗржЯрж╛ ржлрж╛ржЗрж▓ ржЖржкрж▓рзЛржб ржХрж░рзБржи ржПржмржВ ржХрж╛рж╕рзНржЯржо рж░рж┐ржкрзЛрж░рзНржЯ ржбрж╛ржЙржирж▓рзЛржб ржХрж░рзБржи
      </p>
    </div>

    <!-- Error -->
    {% if error %}
    <div class="alert alert-danger d-flex align-items-center gap-2 bn" role="alert">
      <i class="bi bi-exclamation-triangle-fill"></i>
      <span>{{ error }}</span>
    </div>
    {% endif %}

    <!-- Upload card -->
    <div class="card">
      <div class="card-body p-4">
        <form method="post" enctype="multipart/form-data" id="uploadForm">
          {% csrf_token %}

          <!-- Drop zone -->
          <div class="upload-zone position-relative d-flex flex-column align-items-center
                      justify-content-center p-5 mb-3" id="dropZone">
            <input type="file" name="excel_file" id="fileInput"
                   accept=".xlsx,.xls" required />
            <div class="upload-icon mb-3">
              <i class="bi bi-file-earmark-excel"></i>
            </div>
            <p class="fw-semibold mb-1 bn">ржлрж╛ржЗрж▓ ржЯрзЗржирзЗ ржЖржирзБржи ржмрж╛ ржХрзНрж▓рж┐ржХ ржХрж░рзБржи</p>
            <p class="text-muted mb-0 bn-sm" id="fileName">
              .xlsx ржмрж╛ .xls ржлрж░ржорзНржпрж╛ржЯ рж╕ржорж░рзНржерж┐ржд
            </p>
          </div>

          <button type="submit" class="btn btn-primary w-100 py-2 bn-sm fw-semibold"
                  id="submitBtn" disabled>
            <i class="bi bi-upload me-2"></i>ржЖржкрж▓рзЛржб ржУ ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛ ржХрж░рзБржи
          </button>
        </form>
      </div>
    </div>

    <!-- Info cards -->
    <div class="row g-3 mt-1">
      {% for icon, title, desc in available_reports %}
      <!-- rendered below via template tag workaround -->
      {% endfor %}
      <div class="col-6">
        <div class="card h-100">
          <div class="card-body p-3 text-center">
            <div style="font-size:1.8rem">ЁЯУК</div>
            <p class="fw-semibold mb-0 bn-sm mt-1">Performance Report</p>
            <p class="text-muted" style="font-size:.75rem">ржмрж░рзНрждржорж╛ржи ржХрж░рзНржорж╕рзНржерж▓ ржУ ржкржж</p>
          </div>
        </div>
      </div>
      <div class="col-6">
        <div class="card h-100">
          <div class="card-body p-3 text-center">
            <div style="font-size:1.8rem">ЁЯОУ</div>
            <p class="fw-semibold mb-0 bn-sm mt-1">Appraisal Report</p>
            <p class="text-muted" style="font-size:.75rem">ржкржжрзЛржирзНржирждрж┐ ржУ ржпрзЛржЧрзНржпрждрж╛</p>
          </div>
        </div>
      </div>
      <div class="col-6">
        <div class="card h-100">
          <div class="card-body p-3 text-center">
            <div style="font-size:1.8rem">ЁЯФД</div>
            <p class="fw-semibold mb-0 bn-sm mt-1">Transfer Report</p>
            <p class="text-muted" style="font-size:.75rem">ржмржжрж▓рж┐ ржЖржжрзЗрж╢ ржУ ржЗрждрж┐рж╣рж╛рж╕</p>
          </div>
        </div>
      </div>
      <div class="col-6">
        <div class="card h-100">
          <div class="card-body p-3 text-center">
            <div style="font-size:1.8rem">ЁЯУЛ</div>
            <p class="fw-semibold mb-0 bn-sm mt-1">Seniority Report</p>
            <p class="text-muted" style="font-size:.75rem">ржЬрзНржпрзЗрж╖рзНржарждрж╛ рждрж╛рж▓рж┐ржХрж╛</p>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  const fileInput = document.getElementById('fileInput');
  const fileName  = document.getElementById('fileName');
  const submitBtn = document.getElementById('submitBtn');
  const dropZone  = document.getElementById('dropZone');

  fileInput.addEventListener('change', () => {
    if (fileInput.files.length > 0) {
      fileName.textContent = fileInput.files[0].name;
      submitBtn.disabled = false;
    }
  });

  // Drag-and-drop visual feedback
  ['dragenter','dragover'].forEach(evt => {
    dropZone.addEventListener(evt, e => {
      e.preventDefault();
      dropZone.classList.add('dragover');
    });
  });
  ['dragleave','drop'].forEach(evt => {
    dropZone.addEventListener(evt, e => {
      e.preventDefault();
      dropZone.classList.remove('dragover');
    });
  });
  dropZone.addEventListener('drop', e => {
    const files = e.dataTransfer.files;
    if (files.length) {
      fileInput.files = files;
      fileName.textContent = files[0].name;
      submitBtn.disabled = false;
    }
  });

  // Loading state on submit
  document.getElementById('uploadForm').addEventListener('submit', () => {
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛ рж╣ржЪрзНржЫрзЗтАж';
  });
</script>
{% endblock %}
